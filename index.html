<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Voxel World</title>
<style>
  body { margin:0; overflow:hidden; background:#000; }
  #info {
    position: fixed;
    top: 10px;
    left: 10px;
    color: white;
    font-family: monospace;
    z-index: 10;
  }
</style>
</head>
<body>

<div id="info">
  ðŸ§± Voxel World<br>
  Move: Touch / Mouse<br>
  Look: Drag
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152/build/three.min.js"></script>

<script>
// =======================
// SCENE SETUP
// =======================
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x87ceeb);

const camera = new THREE.PerspectiveCamera(
  75,
  innerWidth / innerHeight,
  0.1,
  1000
);

const renderer = new THREE.WebGLRenderer({ antialias:true });
renderer.setSize(innerWidth, innerHeight);
document.body.appendChild(renderer.domElement);

// =======================
// LIGHT
// =======================
const sun = new THREE.DirectionalLight(0xffffff, 1);
sun.position.set(50,100,50);
scene.add(sun);

scene.add(new THREE.AmbientLight(0x404040));

// =======================
// PLAYER
// =======================
camera.position.set(0, 5, 10);

let yaw = 0;
let pitch = 0;

// =======================
// BLOCK MATERIALS
// =======================
const grassMat = new THREE.MeshLambertMaterial({ color: 0x3cb371 });
const dirtMat  = new THREE.MeshLambertMaterial({ color: 0x8b4513 });

// =======================
// BLOCK GEOMETRY
// =======================
const blockGeo = new THREE.BoxGeometry(1,1,1);

// =======================
// WORLD GENERATION
// =======================
const world = new THREE.Group();

function height(x,z){
  return Math.floor(
    Math.sin(x*0.3) * 2 +
    Math.cos(z*0.3) * 2 + 4
  );
}

for(let x=-20;x<20;x++){
  for(let z=-20;z<20;z++){
    let h = height(x,z);

    for(let y=0;y<h;y++){
      const mat = (y === h-1) ? grassMat : dirtMat;
      const block = new THREE.Mesh(blockGeo, mat);
      block.position.set(x,y,z);
      world.add(block);
    }
  }
}

scene.add(world);

// =======================
// CONTROLS (TOUCH + MOUSE)
// =======================
let dragging = false;
let lastX = 0;
let lastY = 0;

function start(x,y){
  dragging = true;
  lastX = x;
  lastY = y;
}

function move(x,y){
  if(!dragging) return;

  yaw   -= (x-lastX)*0.005;
  pitch -= (y-lastY)*0.005;
  pitch = Math.max(-1.5, Math.min(1.5, pitch));

  lastX = x;
  lastY = y;
}

function end(){
  dragging = false;
}

document.addEventListener("mousedown",e=>start(e.clientX,e.clientY));
document.addEventListener("mousemove",e=>move(e.clientX,e.clientY));
document.addEventListener("mouseup",end);

document.addEventListener("touchstart",e=>{
  start(e.touches[0].clientX,e.touches[0].clientY);
});
document.addEventListener("touchmove",e=>{
  move(e.touches[0].clientX,e.touches[0].clientY);
});
document.addEventListener("touchend",end);

// =======================
// MOVEMENT
// =======================
let forward = 0;

document.addEventListener("touchstart",()=>forward=0.1);
document.addEventListener("touchend",()=>forward=0);

function updatePlayer(){
  camera.rotation.order = "YXZ";
  camera.rotation.y = yaw;
  camera.rotation.x = pitch;

  camera.position.x -= Math.sin(yaw)*forward;
  camera.position.z -= Math.cos(yaw)*forward;
}

// =======================
// RESIZE
// =======================
addEventListener("resize",()=>{
  camera.aspect = innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth, innerHeight);
});

// =======================
// LOOP
// =======================
function animate(){
  requestAnimationFrame(animate);
  updatePlayer();
  renderer.render(scene,camera);
}

animate();
</script>

</body>
</html>
